<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamEngine - VPS Automation</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* CSS FIX: Input Jam Custom agar terlihat seperti Time Picker */
        .time-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        .time-input-wrapper input {
            letter-spacing: 2px;
            font-family: monospace;
            font-size: 1.1rem;
            text-align: center;
            padding-right: 40px; /* Space for icon */
        }
        .time-icon {
            position: absolute;
            right: 10px;
            color: #aaa;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">StreamEngine v1.5</div>
        <div class="stats-bar" id="system-stats">Connecting...</div>
        <div class="clock" id="digital-clock">00:00</div>
    </header>

    <div class="container">
        
        <section>
            <div class="section-header">
                <h2>Active Streams</h2>
                <button onclick="openStreamModal()">+ New Stream</button>
            </div>
            <div class="card-grid" id="streams-list"></div>
        </section>

        <hr>

        <section>
            <div class="section-header">
                <h2>Video Gallery</h2>
                <div>
                    <button onclick="document.getElementById('file-input').click()">Upload Local</button>
                    <button onclick="openModal('modal-import')">Import Link</button>
                </div>
                <input type="file" id="file-input" style="display:none" accept=".mp4,.mkv,.mov,.avi" onchange="uploadVideo(this)">
            </div>

            <div id="upload-progress-container" style="display:none; margin-bottom: 20px;">
                <label>Uploading... <span id="progress-text">0%</span></label>
                <div style="width: 100%; background: #333; height: 10px; border-radius: 5px; overflow: hidden;">
                    <div id="progress-bar" style="width: 0%; height: 100%; background: #00d4ff; transition: width 0.2s;"></div>
                </div>
            </div>

            <div class="video-list" id="video-list"></div>
        </section>

    </div>

    <div id="modal-stream" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modal-stream')">&times;</span>
            <h3 id="modal-stream-title">Konfigurasi Stream</h3>
            
            <form id="stream-form" onsubmit="saveStream(event)">
                <input type="hidden" name="stream_id" id="stream-id">

                <input type="text" name="title" id="stream-title" placeholder="Stream Title" required>
                
                <input type="hidden" name="rtmp_url" value="rtmp://a.rtmp.youtube.com/live2">
                <p style="font-size:0.8rem; color:#aaa; margin-top:-10px; margin-bottom:10px;">Server: YouTube Live (Default)</p>

                <input type="text" name="stream_key" id="stream-key" placeholder="Paste Stream Key Here" required>
                
                <label>Pilih Video:</label>
                <select name="video_id" id="video-select" required></select>

                <label>Mode Jadwal:</label>
                <select name="schedule_type" id="schedule-type" onchange="toggleScheduleInputs(this.value)">
                    <option value="daily">Harian (Daily Auto)</option>
                    <option value="once">Sekali Jalan (Once)</option>
                </select>

                <div id="input-once" style="display:none;">
                    <label>Start Time:</label>
                    <input type="datetime-local" name="start_time" id="start-time">
                    <label>End Time:</label>
                    <input type="datetime-local" name="end_time" id="end-time">
                </div>

                <div id="input-daily">
                    <label>Jam Mulai (Format 24 Jam, cth: 13:00):</label>
                    
                    <div class="time-input-wrapper">
                        <input type="text" 
                               name="daily_start_time" 
                               id="daily-start-time" 
                               placeholder="HH:MM" 
                               pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]"
                               title="Format Jam:Menit (contoh 14:30)"
                               maxlength="5"
                               oninput="formatTimeInput(this)"
                               required>
                        <span class="time-icon">ðŸ•’</span>
                    </div>
                    <small style="color:#666; display:block; margin-top:5px;">Contoh: 07:00, 14:30, 23:59</small>
                    
                    <label style="margin-top:15px;">Durasi Live:</label>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1">
                            <input type="number" name="duration_hours" id="duration-hours" placeholder="Jam" min="0" value="1">
                            <small>Jam</small>
                        </div>
                        <div style="flex:1">
                            <input type="number" name="duration_minutes" id="duration-minutes" placeholder="Menit" min="0" max="59" value="0">
                            <small>Menit</small>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-primary" id="btn-save-stream" style="margin-top:20px;">Simpan Jadwal</button>
            </form>
        </div>
    </div>

    <div id="modal-import" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modal-import')">&times;</span>
            <h3>Import Video from URL</h3>
            <p style="font-size:0.8rem; color:#aaa">Support Google Drive (Public) & Direct Links</p>
            <form onsubmit="importVideo(event)">
                <label>URL Video / GDrive Link:</label>
                <input type="url" name="url" placeholder="https://..." required>
                <div id="import-loading" style="display:none; margin-top:10px;">
                    <div style="color: yellow; font-weight:bold;">Downloading to server...</div>
                    <div style="font-size:0.8rem; color:#aaa;">Mohon tunggu, jangan tutup popup ini.</div>
                </div>
                <button type="submit" id="btn-import" style="margin-top:15px;">Download & Import</button>
            </form>
        </div>
    </div>

    <div id="modal-player" class="modal" style="z-index: 300;">
        <div class="modal-content" style="background:black; width:90%; max-width:800px; padding:0; border:1px solid #444;">
            <div style="padding:10px; display:flex; justify-content:space-between; background:#1a1a1a; border-bottom:1px solid #333;">
                <h3 id="player-title" style="margin:0; font-size:1rem; color:white;">Preview</h3>
                <span class="close" onclick="closePlayer()" style="color:white; font-size:1.5rem; cursor:pointer;">&times;</span>
            </div>
            <div style="position:relative; padding-top:56.25%;">
                <video id="main-player" controls style="position:absolute; top:0; left:0; width:100%; height:100%;" preload="none"></video>
            </div>
        </div>
    </div>

    <script>
        // Fungsi agar otomatis tambah titik dua (:) saat ketik jam
        function formatTimeInput(input) {
            let val = input.value.replace(/[^0-9]/g, ''); // Hapus non-angka
            if (val.length > 2) {
                val = val.substring(0, 2) + ':' + val.substring(2, 4);
            }
            input.value = val;
        }
    </script>

    <script src="js/script.js"></script>
</body>
</html>
